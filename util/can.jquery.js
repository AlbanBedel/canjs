(function(d){$.extend(d,jQuery,{trigger:function(a,b,c){a.trigger?a.trigger(b,c):$.event.trigger(b,c,a,true)},addEvent:function(a,b){$([this]).bind(a,b);return this},removeEvent:function(a,b){$([this]).unbind(a,b);return this},$:jQuery});$.each(["bind","unbind","undelegate","delegate"],function(a,b){d[b]=function(){var c=this[b]?this:$([this]);c[b].apply(c,arguments);return this}});$.each(["append","filter","addClass","remove","data"],function(a,b){d[b]=function(c){return c[b].apply(c,d.makeArray(arguments).slice(1))}});
var r={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./,quote:/"/g,singleQuote:/'/g},V=function(a,b,c){return a[b]!==undefined?a[b]:c&&(a[b]={})},H=function(a){var b=typeof a;return a&&(b=="function"||b=="object")},W;d.String=d.extend({esc:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(r.quote,"&#34;").replace(r.singleQuote,"&#39;")},getObject:W=function(a,b,c){a=
a?a.split(r.dot):[];var e=a.length,f,g,i,h=0;b=d.isArray(b)?b:[b||window];if(e==0)return b[0];for(;f=b[h++];){for(i=0;i<e-1&&H(f);i++)f=V(f,a[i],c);if(H(f)){g=V(f,a[i],c);if(g!==undefined){c===false&&delete f[a[i]];return g}}}},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},underscore:function(a){return a.replace(r.colons,"/").replace(r.words,"$1_$2").replace(r.lowUp,"$1_$2").replace(r.dash,"_").toLowerCase()},sub:function(a,b,c){var e=[];c=typeof c=="boolean"?!c:c;e.push(a.replace(r.replacer,
function(f,g){f=W(g,b,c);if(H(f)){e.push(f);return""}else return""+f}));return e.length<=1?e[0]:e},_regs:r});var I=false;d.Construct=function(){if(arguments.length)return d.Construct.extend.apply(d.Construct,arguments)};d.extend(d.Construct,{newInstance:function(){var a=this.instance(),b;if(a.setup)b=a.setup.apply(a,arguments);if(a.init)a.init.apply(a,d.isArray(b)?b:arguments);return a},_inherit:function(a,b,c){d.extend(c||a,a||{})},setup:function(a){this.defaults=d.extend(true,{},a.defaults,this.defaults);
return arguments},instance:function(){I=true;var a=new this;I=false;return a},extend:function(a,b,c){function e(){if(!I)return this.constructor!==e&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.constructor.newInstance.apply(this.constructor,arguments)}if(typeof a!="string"){c=b;b=a;a=null}if(!c){c=b;b=null}c=c||{};var f=this,g=this.prototype,i,h,j,k;k=this.instance();this._inherit(c,g,k);for(i in this)if(this.hasOwnProperty(i))e[i]=this[i];this._inherit(b,this,e);
if(a){j=a.split(/\./);h=j.pop();j=g=d.String.getObject(j.join("."),window,true);var m=d.String.underscore(a.replace(/\./g,"_")),l=d.String.underscore(h);g[h]=e}d.extend(e,{prototype:k,namespace:j,shortName:h,_shortName:l,_fullName:m,constructor:e,fullName:a});e.prototype.constructor=e;h=e.setup.apply(e,[f].concat(d.makeArray(arguments)));if(e.init)e.init.apply(e,h||[f].concat(d.makeArray(arguments)));return e}});var s=function(a){return typeof a==="object"&&a!==null&&a&&!(a instanceof Date)},J=function(a,
b){return d.each(a,function(c,e){e&&e.unbind&&e.unbind("change"+b)})},K=function(a,b,c){if(a instanceof w)J([a],c._namespace);else a=d.isArray(a)?new w.List(a):new w(a);a.bind("change"+c._namespace,function(e){var f=d.makeArray(arguments);e=f.shift();f[0]=b==="*"?c.indexOf(a)+"."+f[0]:b+"."+f[0];d.trigger(c,e,f)});return a},X=0,u=null,Y=function(){if(!u){u=[];return true}},p=function(a,b,c){if(!a._init)if(u)u.push([a,{type:b,batchNum:Z},c]);else return d.trigger(a,b,c)},Z=1,aa=function(){var a=u.length,
b=u.slice(0);u=null;Z++;for(var c=0;c<a;c++)d.trigger.apply(d,b[c])},E=function(a,b,c){a.each(function(e,f){c[e]=s(f)&&typeof f[b]=="function"?f[b]():f});return c},y=function(a){return function(){return d[a].apply(this,arguments)}},F=y("addEvent");y=y("removeEvent");var L=function(a){return d.isArray(a)?a:(""+a).split(".")},w=d.Construct("can.Observe",{setup:function(){d.Construct.setup.apply(this,arguments)},bind:F,unbind:y},{setup:function(a){this._data={};this._namespace=".observe"+ ++X;this._init=
1;this.attr(a);delete this._init},attr:function(a,b){var c=typeof a;if(c!="string"&&c!="number")return this._attrs(a,b);else if(b===undefined){w.__reading&&w.__reading(this,a);return this._get(a)}else{this._set(a,b);return this}},each:function(){return d.each.apply(null,[this.__get()].concat(d.makeArray(arguments)))},removeAttr:function(a){a=L(a);var b=a.shift(),c=this._data[b];if(a.length)return c.removeAttr(a);else{delete this._data[b];b in this.constructor.prototype||delete this[b];p(this,"change",
[b,"remove",undefined,c]);return c}},_get:function(a){a=L(a);var b=this.__get(a.shift());return a.length?b?b._get(a):undefined:b},__get:function(a){return a?this._data[a]:this._data},_set:function(a,b){a=L(a);var c=a.shift(),e=this.__get(c);if(s(e)&&a.length)e._set(a,b);else if(a.length)throw"can.Observe: set a property on an object that does not exist";else this.__set(c,b,e)},__set:function(a,b,c){if(b!==c){var e=this.__get().hasOwnProperty(a)?"set":"add";this.___set(a,s(b)?K(b,a,this):b);p(this,
"change",[a,e,b,c]);p(this,a,b,c);c&&J([c],this._namespace)}},___set:function(a,b){this._data[a]=b;a in this.constructor.prototype||(this[a]=b)},bind:F,unbind:y,serialize:function(){return E(this,"serialize",{})},_attrs:function(a,b){if(a===undefined)return E(this,"attr",{});a=d.extend(true,{},a);var c,e=Y(),f=this;this.each(function(g,i){var h=a[g];if(h===undefined)b&&f.removeAttr(g);else{if(s(i)&&s(h))i.attr(h,b);else i!=h&&f._set(g,h);delete a[g]}});for(c in a){newVal=a[c];this._set(c,newVal)}e&&
aa();return this}}),sa=[].splice,M=w("can.Observe.List",{setup:function(a,b){this.length=0;this._namespace=".list"+ ++X;this._init=1;this.bind("change",d.proxy(this._changes,this));this.push.apply(this,d.makeArray(a||[]));d.extend(this,b);delete this._init},_changes:function(a,b,c,e,f){if(b.indexOf(".")===-1)if(c==="add"){p(this,c,[e,+b]);p(this,"length",[this.length])}else if(c==="remove"){p(this,c,[f,+b]);p(this,"length",[this.length])}},__get:function(a){return a?this[a]:this},___set:function(a,
b){this[a]=b},serialize:function(){return E(this,"serialize",[])},splice:function(a,b){var c=d.makeArray(arguments),e;for(e=2;e<c.length;e++){var f=c[e];if(s(f))c[e]=K(f,"*",this)}if(b===undefined)b=c[1]=this.length-a;e=sa.apply(this,c);if(b>0){p(this,"change",[""+a,"remove",undefined,e]);J(e,this._namespace)}c.length>2&&p(this,"change",[""+a,"add",c.slice(2),e]);return e},_attrs:function(a,b){if(a===undefined)return E(this,"attr",[]);a=a.slice(0);for(var c=Math.min(a.length,this.length),e=Y(),f=
0;f<c;f++){var g=this[f],i=a[f];if(s(g)&&s(i))g.attr(i,b);else g!=i&&this._set(f,i)}if(a.length>this.length)this.push(a.slice(this.length));else a.length<this.length&&b&&this.splice(a.length);e&&aa()}}),ba=function(a){return a[0]&&d.isArray(a[0])?a[0]:d.makeArray(a)};d.each({push:"length",unshift:0},function(a,b){M.prototype[a]=function(){for(var c=ba(arguments),e=b?this.length:0,f=0;f<c.length;f++){var g=c[f];if(s(g))c[f]=K(g,"*",this)}if(c.length==1&&this.comparator){this.splice(this.sortedIndex(c[0]),
0,c[0]);return this.length}f=[][a].apply(this,c);if(this.comparator&&c.length>1){this.sort(null,true);p(this,"reset",[c])}else p(this,"change",[""+e,"add",c,undefined]);return f}});d.each({pop:"length",shift:0},function(a,b){M.prototype[a]=function(){var c=ba(arguments),e=b&&this.length?this.length-1:0;c=[][a].apply(this,c);p(this,"change",[""+e,"remove",undefined,[c]]);c&&c.unbind&&c.unbind("change"+this._namespace);return c}});M.prototype.indexOf=[].indexOf||function(a){return d.inArray(a,this)};
var ta=/^\d+$/,ua=/([^\[\]]+)|(\[\])/g,ca=/\+/g,va=/([^?#]*)(#.*)?$/;d.extend(d.String,{deparam:function(a){if(!a||!va.test(a))return{};var b={};a=a.split("&");for(var c,e=0;e<a.length;e++){c=b;var f=a[e].split("=");if(f.length!=2)f=[f[0],f.slice(1).join("=")];var g=decodeURIComponent(f[0].replace(ca," "));f=decodeURIComponent(f[1].replace(ca," "));g=g.match(ua);for(var i=0;i<g.length-1;i++){var h=g[i];c[h]||(c[h]=ta.test(g[i+1])||g[i+1]=="[]"?[]:{});c=c[h]}lastPart=g[g.length-1];if(lastPart=="[]")c.push(f);
else c[lastPart]=f}return b}});var wa=$.cleanData;$.cleanData=function(a){for(var b=0,c;(c=a[b])!==undefined;b++)$(c).triggerHandler("destroyed");wa(a)};var da=/\:([\w\.]+)/g,ea=/^(?:&[^=]+=[^&]*)+/,xa=function(a){var b=[];t(a,function(c,e){e&&b.push(c==="className"?"class":c,'="',d.String.esc(e),'"')});return b.join(" ")},ya=function(a,b){for(var c=0,e=0;e<a.names.length;e++){if(!b.hasOwnProperty(a.names[e]))return-1;c++}return c},fa=true,z=window.location,t=d.each,n=d.extend;d.route=function(a,
b){var c=[],e=a.replace(da,function(f,g){c.push(g);return"([^\\/\\&]*)"});d.route.routes[a]={test:new RegExp("^"+e+"($|&)"),route:a,names:c,defaults:b||{},length:a.split("/").length};return d.route};n(d.route,{param:function(a){delete a.route;var b,c=0,e,f=a.route;delete a.route;f&&(b=d.route.routes[f])||t(d.route.routes,function(h,j){e=ya(j,a);if(e>c){b=j;c=e}});if(b){var g=n({},a);f=b.route.replace(da,function(h,j){delete g[j];return a[j]===b.defaults[j]?"":encodeURIComponent(a[j])});var i;t(b.defaults,
function(h,j){g[h]===j&&delete g[h]});i=d.param(g);return f+(i?"&"+i:"")}return d.isEmptyObject(a)?"":"&"+d.param(a)},deparam:function(a){var b={length:-1};t(d.route.routes,function(g,i){if(i.test.test(a)&&i.length>b.length)b=i});if(b.length>-1){var c=a.match(b.test),e=c.shift(),f=(e=a.substr(e.length-(c[c.length-1]==="&"?1:0)))&&ea.test(e)?d.String.deparam(e.slice(1)):{};f=n(true,{},b.defaults,f);t(c,function(g,i){if(i&&i!=="&")f[b.names[g]]=decodeURIComponent(i)});f.route=b.route;return f}if(a.charAt(0)!==
"&")a="&"+a;return ea.test(a)?d.String.deparam(a.slice(1)):{}},data:new d.Observe({}),routes:{},ready:function(a){if(a===false)fa=false;if(a===true||fa===true)ga();return d.route},url:function(a,b){return b?"#!"+d.route.param(n({},N,a)):"#!"+d.route.param(a)},link:function(a,b,c,e){return"<a "+xa(n({href:d.route.url(b,e)},c))+">"+a+"</a>"},current:function(a){return z.hash=="#!"+d.route.param(a)}});t(["bind","unbind","delegate","undelegate","attr","removeAttr"],function(a,b){d.route[b]=function(){return d.route.data[b].apply(d.route.data,
arguments)}});var N,ga=function(){var a=z.hash.substr(1,1)==="!"?z.hash.slice(2):z.hash.slice(1);N=d.route.deparam(a);d.route.attr(N,true)};d.bind.call(window,"hashchange",ga);d.route.bind("change",function(a){var b;return function(){var c=arguments,e=this;clearTimeout(b);b=setTimeout(function(){a.apply(e,c)},1)}}(function(){z.hash="#!"+d.route.param(d.route.serialize())}));d.bind.call(document,"ready",d.route.ready);F=function(a,b,c){d.bind.call(a,b,c);return function(){d.unbind.call(a,b,c)}};var za=
d.isFunction;n=d.extend;t=d.each;var Aa=[].slice,Ba=$.event&&$.event.special||{},Ca=function(a,b,c,e){d.delegate.call(a,b,c,e);return function(){d.undelegate.call(a,b,c,e)}},ha=function(a,b,c,e){return e?Ca(a,d.trim(e),b,c):F(a,b,c)},O=function(a,b){var c=typeof b=="string"?a[b]:b;return function(){a.called=b;return c.apply(a,[this.nodeName?d.$(this):this].concat(Aa.call(arguments,0)))}},Da=/[^\w]/,ia=/\{([^\}]+)\}/g,Ea=/^(?:(.*?)\s)?([\w\.\:>]+)$/,P;d.Construct("can.Control",{setup:function(){d.Construct.setup.apply(this,
arguments);if(this!==d.Control){var a=this.pluginName||this._fullName,b;a!=="j_query_control"&&this.plugin(a);this.actions={};for(b in this.prototype)if(!(b=="constructor"||!za(this.prototype[b])))if(this._isAction(b))this.actions[b]=this._action(b)}},_isAction:function(a){return Da.test(a)?true:d.inArray(a,this.listensTo)>-1||Ba[a]||Q[a]},plugin:function(){},_action:function(a,b){ia.lastIndex=0;if(!b&&ia.test(a))return null;a=b?d.String.sub(a,[b,window]):a;b=d.isArray(a);var c=(b?a[1]:a).match(Ea);
return{processor:Q[c[2]]||P,parts:c,delegate:b?a[0]:undefined}},processors:{},listensTo:[],defaults:{}},{setup:function(a,b){var c=this.constructor;a=(typeof a=="string"?d.$(a):a.jquery?a:[a])[0];var e=c.pluginName||c._fullName;this.element=d.$(a);e&&e!=="can_control"&&this.element.addClass(e);(a=d.data(this.element,"controls"))||d.data(this.element,"controls",a=[]);a.push(this);this.options=n(n({},c.defaults),b);this.bind();return[this.element,this.options]},bind:function(a,b,c){if(a===undefined){this._bindings=
[];a=this.constructor;b=this._bindings;c=a.actions;var e=this.element;for(funcName in c)if(c.hasOwnProperty(funcName)){ready=c[funcName]||a._action(funcName,this.options);b.push(ready.processor(ready.delegate||e,ready.parts[2],ready.parts[1],funcName,this))}var f=O(this,"destroy");d.bind.call(e,"destroyed",f);b.push(function(g){d.unbind.call(g,"destroyed",f)});return b.length}if(typeof a=="string"){c=b;b=a;a=this.element}return this._binder(a,b,c)},_binder:function(a,b,c,e){if(typeof c=="string")c=
O(this,c);this._bindings.push(ha(a,b,c,e));return this._bindings.length},_unbind:function(){var a=this.element[0];t(this._bindings,function(b,c){c(a)});this._bindings=[]},delegate:function(a,b,c,e){if(typeof a=="string"){e=c;c=b;b=a;a=this.element}return this._binder(a,c,e,b)},update:function(a){n(this.options,a);this._unbind();this.bind()},destroy:function(){var a=this.constructor;a=a.pluginName||a._fullName;this._unbind();a&&a!=="can_control"&&this.element.removeClass(a);a=d.data(this.element,"controls");
a.splice(d.inArray(this,a),1);d.trigger(this,"destroyed");this.element=null}});var Q=d.Control.processors;P=function(a,b,c,e,f){return ha(a,b,O(f,e),c)};t("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset resize scroll select submit focusin focusout mouseenter mouseleave".split(" "),function(a,b){Q[b]=P});var Fa=function(a){return a.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},R=d.makeArray,Ga=1,q=d.view=function(a,b,c,e){a=d.render(a,b,
c,e);if(A(a))return a.pipe(function(f){return d.view.frag(f)});return d.view.frag(a)};d.extend(d.view,{frag:function(a){a=d.buildFragment([a],[document.body]).fragment;a.childNodes.length||a.appendChild(document.createTextNode(""));return d.view.hookup(a)},hookup:function(a){var b,c,e,f=[],g,i=0;d.each(a.childNodes?R(a.childNodes):a,function(h,j){if(j.nodeType!=3){f.push(j);f.push.apply(f,R(j.getElementsByTagName("*")))}});for(b=d.filter(d.$(f),"[data-view-id]");g=b[i++];)if(g.getAttribute&&(c=g.getAttribute("data-view-id"))&&
(e=q.hookups[c])){e(g,c);delete q.hookups[c];g.removeAttribute("data-view-id")}return a},hookups:{},hook:function(a){var b=++Ga;q.hookups[b]=a;return b},cached:{},cache:true,register:function(a){this.types["."+a.suffix]=a},types:{},ext:".ejs",registerScript:function(){},preload:function(){}});d.render=function(a,b,c,e){if(typeof c==="function"){e=c;c=undefined}var f=Ha(b);if(f.length){var g=new d.Deferred;f.push(ja(a,true));d.when.apply(d,f).then(function(h){var j=R(arguments),k=j.pop();if(A(b))b=
ka(h);else for(var m in b)if(A(b[m]))b[m]=ka(j.shift());j=k(b,c);g.resolve(j);e&&e(j)});return g}else{var i;f=typeof e==="function";g=ja(a,f);if(f){i=g;g.done(function(h){e(h(b,c))})}else g.done(function(h){i=h(b,c)});return i}};var la=function(a,b){if(!a.match(/[^\s]/))throw"can.view ERROR: There is no template or an empty template at "+b;},ja=function(a,b){var c=a.match(/\.[\w\d]+$/),e,f,g,i=function(k){k=e.renderer(g,k);k=(new d.Deferred).resolve(k);if(q.cache)q.cached[g]=k;return k};if(f=document.getElementById(a))c=
"."+f.type.match(/\/(x\-)?(.+)/)[2];if(!c){c=q.ext;a+=q.ext}if(d.isArray(c))c=c[0];g=Fa(a);if(a.match(/^\/\//)){var h=a.substr(2);a=typeof steal==="undefined"?(a="/"+h):steal.root.mapJoin(h)}e=q.types[c];if(q.cached[g])return q.cached[g];else if(f)return i(f.innerHTML);else{var j=new d.Deferred;d.ajax({async:b,url:a,dataType:"text",error:function(k){la("",a);j.reject(k)},success:function(k){la(k,a);j.resolve(e.renderer(g,k));if(q.cache)q.cached[g]=j}});return j}},A=function(a){return a&&d.isFunction(a.always)},
Ha=function(a){var b=[];if(A(a))return[a];else for(var c in a)A(a[c])&&b.push(a[c]);return b},ka=function(a){return d.isArray(a)&&a.length===3&&a[1]==="success"?a[0]:a},ma=function(a,b,c){var e=new d.Deferred;a.then(function(){arguments[0]=b[c](arguments[0]);e.resolve.apply(e,arguments)},function(){e.resolveWith.apply(this,arguments)});return e},Ia=0,B=function(a){return a[a.constructor.id]},C=function(a,b,c,e,f,g){if(typeof a=="string"){a=a.split(" ");a={url:a.pop(),type:a.pop()}}a.data=typeof b==
"object"&&!d.isArray(b)?d.extend(a.data||{},b):b;a.url=d.String.sub(a.url,a.data,true);return d.ajax(d.extend({type:c||"post",dataType:e||"json",success:f,error:g},a))},na=function(a,b,c,e,f){var g;g=[a.serialize()];var i=a.constructor,h;b=="destroy"&&g.shift();b!=="create"&&g.unshift(B(a));h=i[b].apply(i,g);g=h.pipe(function(j){a[f||b+"d"](j,h);return a});if(h.abort)g.abort=function(){h.abort()};g.then(c,e);return g};ajaxMethods={create:function(a){return function(b){return C(a||this._shortName,
b)}},update:function(a){return function(b,c){c=c||{};var e=this.id;if(c[e]&&c[e]!==b){c["new"+d.String.capitalize(b)]=c[e];delete c[e]}c[e]=b;return C(a||this._url,c,"put")}},destroy:function(a){return function(b){var c={};c[this.id]=b;return C(a||this._url,c,"delete")}},findAll:function(a){return function(b,c,e){return ma(C(a||this._shortName,b,"get","json"),this,"models").then(c,e)}},findOne:function(a){return function(b,c,e){return ma(C(a||this._url,b,"get","json"),this,"model").then(c,e)}}};d.Observe("can.Model",
{setup:function(){d.Observe.apply(this,arguments);if(this!==d.Model){var a=this;d.each(ajaxMethods,function(e,f){var g=a[e];if(typeof g!=="function")a[e]=f(g)});if(a.fullName=="can.Model")a.fullName="Model"+ ++Ia;if(window.jQuery){var b={},c="* "+a.fullName+".model";b[c+"s"]=d.proxy(a.models,a);b[c]=d.proxy(a.model,a);$.ajaxSetup({converters:b})}this.store={};this._url=this._shortName+"/{"+this.id+"}"}},id:"id",models:function(a){if(!a)return null;var b=new (this.List||oa),c=d.isArray(a),e=a instanceof
oa;e=c?a:e?a.serialize():a.data;for(var f=e.length,g=0;g<f;g++)b.push(this.model(e[g]));c||d.each(a,function(i,h){if(i!=="data")b[i]=h});return b},model:function(a){if(!a)return null;if(a instanceof this)a=a.serialize();return this.store[a.id]||new this(a)}},{isNew:function(){var a=B(this);return!(a||a===0)},save:function(a,b){return na(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return na(this,"destroy",a,b,"destroyed")},bind:function(){if(!this._bindings){this.constructor.store[B(this)]=
this;this._bindings=0}this._bindings++;return d.Observe.prototype.bind.apply(this,arguments)},unbind:function(){this._bindings--;this._bindings||delete this.constructor.store[B(this)];return d.Observe.prototype.unbind.apply(this,arguments)},___set:function(a,b){d.Observe.prototype.___set.call(this,a,b);if(a===this.constructor.id&&this._bindings)this.constructor.store[B(this)]=this}});d.each(["created","updated","destroyed"],function(a,b){d.Model.prototype[b]=function(c){var e=this.constructor;c&&
typeof c=="object"&&this.attr(c.attr?c.attr():c);d.trigger(this,b);d.trigger(this,"change",b);d.trigger(e,b,this)}});var oa=d.Observe.List("can.Model.List",{setup:function(){d.Observe.List.prototype.setup.apply(this,arguments);var a=this;this.bind("change",function(b,c){/\w+\.destroyed/.test(c)&&a.splice(a.indexOf(b.target),1)})}});d.Control.processors.route=function(a,b,c,e,f){d.route(c||"");var g,i=function(h){if(d.route.attr("route")===(c||"")&&(h.batchNum===undefined||h.batchNum!==g)){g=h.batchNum;
h=d.route.attr();delete h.route;f[e](h)}};d.route.bind("change",i);return function(){d.route.unbind("change",i)}};var Ja=function(a){eval(a)};n=d.extend;var Ka=/\r\n/g,La=/\r/g,Ma=/\n/g,Na=/\\/g,Oa=/\t/g,Pa=/\{/g,Qa=/\}/g,pa=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,Ra=/([^\s]+)=$/,Sa={"":"span",table:"tr",tr:"td",ol:"li",ul:"li",tbody:"tr",thead:"tr",tfoot:"tr"},Ta=function(a){return a.replace(Na,"\\\\").replace(Ma,"\\n").replace(/"/g,'\\"').replace(Oa,"\\t")},qa=function(a){var b=a.match(Pa);a=a.match(Qa);
return(b?b.length:0)-(a?a.length:0)},S=function(a,b,c){d.each(a,function(e,f){f.cb=function(){c()};f.obj.bind(f.attr,f.cb)});d.bind.call(b,"destroyed",function(){d.each(a,function(e,f){f.obj.unbind(f.attr,f.cb)})})},o=function(a){if(this.constructor!=o){var b=new o(a);return function(c,e){return b.render(c,e)}}if(typeof a=="function")this.template={fn:a};else{n(this,a);this.template=Ua(this.text,this.name)}};d.EJS=o;o.prototype.render=function(a,b){a=a||{};return this.template.fn.call(a,a,new o.Helpers(a,
b||{}))};n(o,{txt:function(a,b,c,e,f){if(d.Observe)d.Observe.__reading=function(h,j){g.push({obj:h,attr:j})};var g=[],i=e.call(c);d.Observe&&delete d.Observe.__reading;if(!g.length)return o[f||b!==0?"clean":"text"](i);a=Sa[a]||"span";if(b==0)return"<"+a+" data-view-id='"+d.view.hook(f?function(h){var j=h.parentNode,k=document.createTextNode(i);j.insertBefore(k,h);j.removeChild(h);S(g,j,function(){k.nodeValue=e.call(c)})}:function(h){var j=function(m,l){m=d.view.frag(m);var T=d.$(d.map(m.childNodes,
function(Va){return Va})),x=l[l.length-1];x.nextSibling?x.parentNode.insertBefore(m,x.nextSibling):x.parentNode.appendChild(m);d.remove(d.$(l));return T},k=j(i,[h]);S(g,h.parentNode,function(){k=j(e.call(c),k)})})+"'></"+a+">";else if(b===1)return i;else{G.push(function(h){var j=d.$(h),k;(k=d.data(j,"hooks"))||d.data(j,"hooks",k={});var m=h.getAttribute(b);j=m.split("__!!__");if(k[b])k[b].funcs.push(e);else k[b]={render:function(){var l=0;return m.replace(/__!!__/g,function(){return k[b].funcs[l++].call(c)})},
funcs:[e]};j.splice(1,0,i);h.setAttribute(b,j.join(""));S(g,h,function(){h.setAttribute(b,k[b].render())})});return"__!!__"}},esc:function(a,b,c,e){return o.txt(a,b,c,e,true)},text:function(a){if(typeof a=="string")return a;if(a===null||a===undefined)return"";var b=a.hookup&&function(c,e){a.hookup.call(a,c,e)}||typeof a=="function"&&a;if(b)return"data-view-id='"+d.view.hook(b)+"'";return a.toString?a.toString():""},pending:function(){if(G.length){var a=G.slice(0);G=[];return" data-view-id='"+d.view.hook(function(b){d.each(a,
function(c,e){e(b)})})+"'"}else return""},clean:function(a){return typeof a=="string"||typeof a=="number"?d.String.esc(""+a):o.text(a)}});var Wa=/(<%%|%%>|<%==|<%=|<%#|<%|%>|<|>|"|')/,D=null,v=null,U=null,ra=function(){return v?"'"+U.match(Ra)[1]+"'":D?1:0},G=[],Ua=function(a,b){a=a.replace(Ka,"\n").replace(La,"\n").split(Wa);var c="",e=["var ___v1ew = [];"],f=function(T,x){e.push("___v1ew.push(",'"',Ta(T),'"'+(x||"")+");")},g=[],i,h=null,j=false,k="",m=0,l;for(D=v=U=null;(l=a[m++])!==undefined;){if(h===
null)switch(l){case "<%":case "<%=":case "<%==":j=1;case "<%#":h=l;c.length>0&&f(c);c="";break;case "<%%":c+="<%";break;case "<":D=1;c+=l;j=0;break;case ">":D=0;if(j){f(c,',can.EJS.pending(),">"');c=""}else c+=l;break;case "'":case '"':if(D)if(v&&v===l)v=null;else if(v===null){v=l;U=i}default:if(i==="<")k=l.split(" ")[0];c+=l;break}else switch(l){case "%>":switch(h){case "<%":i=qa(c);if(i==1){e.push("___v1ew.push(","can.EJS.txt('"+k+"',"+ra()+",this,function(){","var ___v1ew = [];",c);g.push({before:"",
after:"return ___v1ew.join('')}));"})}else{h=g.length&&i==-1?g.pop():{after:";"};h.before&&e.push(h.before);e.push(c,";",h.after)}break;case "<%=":case "<%==":(i=qa(c))&&g.push({before:"return ___v1ew.join('')",after:"}));"});if(pa.test(c)){c=c.match(pa);c="function(__){var "+c[1]+"=can.$(__);"+c[2]+"}"}e.push("___v1ew.push(","can.EJS."+(h==="<%="?"esc":"txt")+"('"+k+"',"+ra()+",this,function(){ return ",c,i?"var ___v1ew = [];":"}));");break}h=null;c="";break;case "<%%":c+="<%";break;default:c+=l;
break}i=l}c.length>0&&f(c);e.push(";");a={out:"with(_VIEW) { with (_CONTEXT) {"+e.join("")+" return ___v1ew.join('')}}"};Ja.call(a,"this.fn = (function(_CONTEXT,_VIEW){"+a.out+"});\r\n//@ sourceURL="+b+".js");return a};o.Helpers=function(a,b){this._data=a;this._extras=b;n(this,b)};o.Helpers.prototype={view:function(a,b,c){return $View(a,b||this._data,c||this._extras)},list:function(a,b){a.attr("length");for(var c=0,e=a.length;c<e;c++)b(a[c],c,a)}};d.view.register({suffix:"ejs",script:function(a,b){return"can.EJS(function(_CONTEXT,_VIEW) { "+
(new o({text:b,name:a})).template.out+" })"},renderer:function(a,b){return o({text:b,name:a})}})})(can={});
